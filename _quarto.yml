project:
  type: website
  output-dir: docs
  resources:
    - "admin/**"
    - "*.html"
    - "js/**"

website:
  title: "Cornell IPM Guidelines Demo"
  navbar:
    left:
      - text: "Home"
        href: index.qmd
      - text: "Grape Guidelines"
        href: grapes/index.html

format:
  html:
    theme: cosmo
    toc: true
    include-in-header:
      text: |
        <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
        <script src="/js/auth.js"></script>
    include-after-body:
      text: |
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, looking for navbar...');
            
            // Debug: Let's see what navbar elements exist
            const navbar = document.querySelector('.navbar');
            console.log('Navbar found:', navbar);
            
            const navbarNav = document.querySelectorAll('.navbar-nav');
            console.log('All navbar-nav elements:', navbarNav);
            
            // Try multiple selectors
            let targetNav = document.querySelector('.navbar-nav.ms-auto') 
                         || document.querySelector('.navbar-nav.navbar-right')
                         || document.querySelector('.navbar-right')
                         || document.querySelector('#navbarCollapse .navbar-nav:last-child')
                         || document.querySelector('.navbar-nav');
            
            console.log('Target nav element:', targetNav);
            
            if (targetNav) {
                const authStatusLi = document.createElement('li');
                authStatusLi.className = 'nav-item';
                authStatusLi.innerHTML = '<div id="auth-status" style="display: flex; align-items: center; padding: 0 15px;">Testing...</div>';
                targetNav.appendChild(authStatusLi);
                console.log('Auth status element added');
                
                // Update status
                setTimeout(updateNavAuthStatus, 100);
            } else {
                console.error('Could not find navbar target');
            }
        });
        
        async function updateNavAuthStatus() {
            console.log('updateNavAuthStatus called');
            const authStatusDiv = document.getElementById('auth-status');
            if (!authStatusDiv) {
                console.error('auth-status div not found');
                return;
            }
            
            try {
                const authStatus = await checkAuth();
                console.log('Auth status:', authStatus);
                
                if (authStatus.authenticated) {
                    const email = authStatus.user?.email || 'User';
                    const displayName = email.split('@')[0];
                    authStatusDiv.innerHTML = `
                        <span style="color: #28a745; margin-right: 10px; font-size: 14px;">
                            âœ“ ${displayName}
                        </span>
                        <button onclick="logout()" 
                                style="background: #dc3545; color: white; border: none; 
                                       padding: 4px 12px; border-radius: 4px; cursor: pointer; 
                                       font-size: 14px;">
                            Log Out
                        </button>
                    `;
                } else {
                    authStatusDiv.innerHTML = `
                        <button onclick="login()" 
                                style="background: #B31B1B; color: white; border: none; 
                                       padding: 6px 16px; border-radius: 4px; cursor: pointer; 
                                       font-size: 14px;">
                            Log In
                        </button>
                    `;
                }
            } catch (error) {
                console.error('Error updating nav auth status:', error);
                authStatusDiv.innerHTML = `
                    <button onclick="login()" 
                            style="background: #B31B1B; color: white; border: none; 
                                   padding: 6px 16px; border-radius: 4px; cursor: pointer; 
                                   font-size: 14px;">
                        Log In
                    </button>
                `;
            }
        }
        </script>
project:
  type: website
  output-dir: docs
  resources:
    - "admin/**"
    - "*.html"
    - "js/**"

website:
  title: "Cornell IPM Guidelines Demo"
  navbar:
    left:
      - text: "Home"
        href: index.qmd
      - text: "Grape Guidelines"
        href: grapes/index.html  # Listing page

format:
  html:
    theme: cosmo
    toc: true
    include-in-header:
      text: |
        <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
        <script src="/js/auth.js"></script>
    include-after-body:
      text: |
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inject auth status into navbar
            const navbar = document.querySelector('.navbar-nav.ms-auto');
            if (navbar) {
                const authStatusLi = document.createElement('li');
                authStatusLi.className = 'nav-item';
                authStatusLi.innerHTML = '<div id="auth-status" style="display: flex; align-items: center; padding: 0 15px;"></div>';
                navbar.appendChild(authStatusLi);
                
                // Now update the status
                updateNavAuthStatus();
            }
        });
        
        async function updateNavAuthStatus() {
            const authStatusDiv = document.getElementById('auth-status');
            if (!authStatusDiv) return;
            
            try {
                const authStatus = await checkAuth();
                
                if (authStatus.authenticated) {
                    const email = authStatus.user?.email || 'User';
                    const displayName = email.split('@')[0];
                    authStatusDiv.innerHTML = `
                        <span style="color: #28a745; margin-right: 10px; font-size: 14px;">
                            âœ“ ${displayName}
                        </span>
                        <button onclick="logout()" 
                                style="background: #dc3545; color: white; border: none; 
                                       padding: 4px 12px; border-radius: 4px; cursor: pointer; 
                                       font-size: 14px;">
                            Log Out
                        </button>
                    `;
                } else {
                    authStatusDiv.innerHTML = `
                        <button onclick="login()" 
                                style="background: #B31B1B; color: white; border: none; 
                                       padding: 6px 16px; border-radius: 4px; cursor: pointer; 
                                       font-size: 14px;">
                            Log In
                        </button>
                    `;
                }
            } catch (error) {
                console.error('Error updating nav auth status:', error);
                authStatusDiv.innerHTML = `
                    <button onclick="login()" 
                            style="background: #B31B1B; color: white; border: none; 
                                   padding: 6px 16px; border-radius: 4px; cursor: pointer; 
                                   font-size: 14px;">
                        Log In
                    </button>
                `;
            }
        }
        </script>